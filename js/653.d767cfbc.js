"use strict";(self["webpackChunkstretch_ui"]=self["webpackChunkstretch_ui"]||[]).push([[653],{29378:(e,t,o)=>{o.d(t,{_7:()=>r,Cw:()=>s,Ws:()=>a,bW:()=>i,Qu:()=>c,Do:()=>l,W7:()=>d,TP:()=>p,uH:()=>f,sc:()=>_,TW:()=>w,hb:()=>h,Fw:()=>y,cf:()=>S});o(8858);var n=o(61959);const r=(0,n.qj)({ros:new ROSLIB.Ros,connected:!1});function s(e){r.ros.connect(e),r.ros.on("connection",(()=>{r.connected=!0,console.log("ROS Connected!")})),r.ros.on("error",(e=>{console.log("Error connecting to websocket server: ",e)})),r.ros.on("close",(()=>{r.connected=!1,console.log("Connection to websocket server closed.")}))}const a=()=>{r.ros.close(),r.connected=!1};function i(e,t){return new ROSLIB.Topic({ros:r.ros,name:e,messageType:t})}const c=(0,n.qj)({jointState:null,stateTopic:new ROSLIB.Topic({ros:r.ros,name:"/state_machine/smach/container_status",messageType:"smach_msgs/SmachContainerStatus"}),jointStateTopic:new ROSLIB.Topic({ros:r.ros,name:"/stretch/joint_states/",messageType:"sensor_msgs/JointState"}),orderTopic:new ROSLIB.Topic({ros:r.ros,name:"/sp_sm/post_orders",messageType:"std_msgs/Int16MultiArray"}),cmdVelTopic:new ROSLIB.Topic({ros:r.ros,name:"/stretch/cmd_vel",messageType:"geometry_msgs/Twist"}),calibrateClient:new ROSLIB.Service({ros:r.ros,name:"/calibrate_the_robot",serviceType:"std_srvs/Trigger"}),magnetClient:new ROSLIB.Service({ros:r.ros,name:"/magnet_toggle",serviceType:"std_srvs/Trigger"}),startClient:new ROSLIB.Service({ros:r.ros,name:"/sp_sm/start",serviceType:"std_srvs/Trigger"}),clearClient:new ROSLIB.Service({ros:r.ros,name:"/sp_sm/clear_orders",serviceType:"std_srvs/Trigger"}),switchToNavClient:new ROSLIB.Service({ros:r.ros,name:"/switch_to_navigation_mode",serviceType:"std_srvs/Trigger"}),switchToPosClient:new ROSLIB.Service({ros:r.ros,name:"/switch_to_position_mode",serviceType:"std_srvs/Trigger"}),runstopClient:new ROSLIB.Service({ros:r.ros,name:"/runstop",serviceType:"std_srvs/SetBool"}),trajectoryClient:new ROSLIB.ActionClient({ros:r.ros,serverName:"/stretch_controller/follow_joint_trajectory",actionName:"control_msgs/FollowJointTrajectoryAction"})});function l(e){var t=new ROSLIB.ServiceRequest({data:e});c.runstopClient.callService(t,(function(e){console.log("Result for service call on "+c.runstopClient.name+": "+e.success+" - "+e.message)}))}function u(e){var t=new ROSLIB.ServiceRequest({});e.callService(t,(function(t){console.log("Result for service call on "+e.name+": "+t.success+" - "+t.message)}))}function d(e){var t=new ROSLIB.Service({ros:r.ros,name:e,serviceType:"std_srvs/Empty"});u(t)}function p(e){var t=new ROSLIB.Service({ros:r.ros,name:e,serviceType:"std_srvs/Trigger"});u(t)}function m(e){var t="{";for(var o in e)t=t+String(o)+":"+String(e[o])+", ";t+="}",console.log("generatePoseGoal( "+t+" )");var n=[],r=[];for(var o in e)n.push(o),r.push(e[o]);var s=new ROSLIB.Goal({actionClient:c.trajectoryClient,goalMessage:{trajectory:{header:{stamp:{secs:0,nsecs:0}},joint_names:n,points:[{positions:r,time_from_start:{secs:0,nsecs:1}}]}}});return console.log("newGoal created ="+s),s.on("feedback",(function(e){console.log("Feedback: "+e.sequence)})),s.on("result",(function(e){console.log("Final Result: "+e.sequence)})),s}function g(e,t){var o=e.name.indexOf(t);return e.position[o]}function v(e){return g(c.jointState,e)}function f(e){console.log("sending baseTranslate command");var t=m({translate_mobile_base:e});t.send()}function _(e){console.log("sending baseTurn command");var t=m({rotate_mobile_base:3.14*e/180});t.send()}function w(e){e?m({gripper_aperture:0}).send():m({gripper_aperture:.125}).send()}function b(e,t){if(console.log("sendIncrementalMove start: jointName ="+e),null!==c.jointState){var o=v(e);console.log(o),o+=t,console.log("poseGoal call: jointName ="+e);var n={[e]:o},r=m(n);return r.send(),!0}return!1}function h(e){console.log("attempting to sendarmMove command"),b("wrist_extension",e)}function y(e){console.log("attempting to sendliftMove command"),b("joint_lift",e)}function S(e){console.log("attempting to send wristMove command"),b("joint_wrist_yaw",3.14*e/180)}c.jointStateTopic.subscribe((function(e){null===c.jointState&&console.log("Received first joint state from ROS"),c.jointState=e}))},72012:(e,t,o)=>{o.d(t,{Z:()=>u});var n=o(83673),r=o(29378),s=o(61959);const a={id:"video-container"},i={props:{srcTopic:{type:String,required:!0},rotate:{type:Number,default:0}},setup(e){const t=e,{srcTopic:o,rotate:i}=(0,s.BK)(t),c=(0,s.iH)(null);let l;const u=(0,s.Fl)((()=>(0,r.bW)(o.value+"/compressed","sensor_msgs/CompressedImage")));function d(e){var t=Math.PI/180*e;if(0!=l.width&&0!=l.height){var o=Math.abs(Math.sin(t)),n=Math.abs(Math.cos(t)),r=l.width,s=l.height;console.log("Image size: "+r+"x"+s);var a=o*s+n*r,i=n*s+o*r;c.value.setAttribute("width",a),c.value.setAttribute("height",i);var u=c.value.getContext("2d");u.save(),u.translate(a/2,i/2),u.rotate(t),u.drawImage(l,-r/2,-s/2,r,s),u.restore()}}return(0,n.bv)((()=>{u.value.subscribe((function(e){l=new Image,l.src="data:image/jpg;base64,"+e.data,l.onload=function(){l.decode().then((()=>{d(t.rotate)}))}}))})),(e,t)=>((0,n.wg)(),(0,n.iD)("div",a,[(0,n._)("canvas",{class:"canvas",ref:(e,t)=>{t["canvas"]=e,c.value=e}},null,512),(0,n.WI)(e.$slots,"default")]))}};var c=o(74260);const l=(0,c.Z)(i,[["__scopeId","data-v-767f8338"]]),u=l},59807:(e,t,o)=>{o.d(t,{Z:()=>g});var n=o(83673);function r(e,t,o,r,s,a){const i=(0,n.up)("q-btn"),c=(0,n.up)("q-input"),l=(0,n.Q2)("touch-repeat");return(0,n.wg)(),(0,n.j4)(c,{outlined:"",dense:"",filled:"",min:"0","model-value":r.modelValue,"onUpdate:modelValue":r.updateModelValue},{prepend:(0,n.w5)((()=>[(0,n.wy)((0,n.Wm)(i,{flat:"",icon:"remove"},null,512),[[l,r.decrement,"0:300:100",{mouse:!0,left:!0}]])])),append:(0,n.w5)((()=>[(0,n.wy)((0,n.Wm)(i,{flat:"",icon:"add"},null,512),[[l,r.increment,"0:300:100",{mouse:!0,right:!0}]])])),_:1},8,["model-value"])}var s=o(61959);const a={props:["modelValue"],emits:["update:modelValue"],setup(e,{expose:t,emit:o}){t();const r=e,{modelValue:a}=(0,s.BK)(r);function i(){var e=u(a.value-1);o("update:modelValue",e)}function c(){var e=u(a.value+1);o("update:modelValue",e)}function l(e){o("update:modelValue",u(e))}function u(e){return(!Number.isInteger(e)||e<0)&&(e=0),e}const d={props:r,emit:o,modelValue:a,decrement:i,increment:c,updateModelValue:l,valueValidation:u,toRefs:s.BK,watch:n.YP};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}};var i=o(74260),c=o(61206),l=o(48240),u=o(90269),d=o(7518),p=o.n(d);const m=(0,i.Z)(a,[["render",r]]),g=m;p()(a,"components",{QInput:c.Z,QBtn:l.Z}),p()(a,"directives",{TouchRepeat:u.Z})},70653:(e,t,o)=>{o.r(t),o.d(t,{default:()=>F});var n=o(83673),r=o(62323);const s={class:"q-pa-lg row q-gutter-md flex-center"},a={id:"joy-container"};function i(e,t,o,i,c,l){const u=(0,n.up)("q-card-section"),d=(0,n.up)("q-tab"),p=(0,n.up)("q-tabs"),m=(0,n.up)("q-separator"),g=(0,n.up)("q-btn"),v=(0,n.up)("q-card-actions"),f=(0,n.up)("q-card"),_=(0,n.up)("q-fab-action"),w=(0,n.up)("q-fab"),b=(0,n.up)("q-page-sticky"),h=(0,n.up)("q-page"),y=(0,n.Q2)("touch-repeat");return(0,n.wg)(),(0,n.j4)(h,{padding:""},{default:(0,n.w5)((()=>[(0,n._)("div",s,[(0,n.Wm)(f,{class:"col",style:{"max-width":"500px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{style:(0,r.j5)(i.modeStyle),id:"card-container"},{default:(0,n.w5)((()=>[(0,n._)("div",a,[(0,n.Wm)(i["Camera"],{"src-topic":"/camera/color/image_raw",rotate:90}),(0,n.Wm)(i["Joy"],{onEvent:i.handleJoystick})])])),_:1},8,["style"]),(0,n.Wm)(p,{modelValue:i.state.controlMode,"onUpdate:modelValue":t[0]||(t[0]=e=>i.state.controlMode=e)},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{class:"text-primary",label:"Base",name:"base"}),(0,n.Wm)(d,{class:"text-secondary",label:"Arm",name:"arm"})])),_:1},8,["modelValue"]),(0,n.Wm)(m,{inset:""}),(0,n.Wm)(v,{class:"q-gutter-md row",align:"center"},{default:(0,n.w5)((()=>[(0,n.wy)((0,n.Wm)(g,{round:"",icon:"west"},null,512),[[y,i.wristInc,"0:300:100",{mouse:!0,left:!0}]]),(0,n.Wm)(g,{round:"",color:"primary",modelValue:i.state.gripperClosed,"onUpdate:modelValue":t[1]||(t[1]=e=>i.state.gripperClosed=e),outline:!!i.state.gripperClosed,icon:i.state.gripperClosed?"close_fullscreen":"open_in_full",onClick:i.toggleGripper},null,8,["modelValue","outline","icon"]),(0,n.wy)((0,n.Wm)(g,{round:"",icon:"east"},null,512),[[y,i.wristDec,"0:300:100",{mouse:!0,left:!0}]])])),_:1})])),_:1})]),(0,n.Wm)(b,{position:"bottom-right",offset:[18,18]},{default:(0,n.w5)((()=>[(0,n.Wm)(w,{icon:"settings",direction:"up","vertical-actions-align":"right",color:"accent"},{default:(0,n.w5)((()=>[(0,n.Wm)(_,{"label-position":"left",label:"Calibrate",color:"primary",icon:"home",onClick:t[2]||(t[2]=e=>i.triggerServiceByName("/calibrate_the_robot"))}),(0,n.Wm)(_,{"label-position":"left",label:"Reset Cameras",color:"warning",icon:"switch_camera",onClick:i.resetCameras}),(0,n.Wm)(_,{"label-position":"left",label:"Runstop",modelValue:i.state.runstop,"onUpdate:modelValue":t[3]||(t[3]=e=>i.state.runstop=e),color:i.state.runstop?"positive":"negative",icon:i.state.runstop?"play_arrow":"stop",onClick:i.toggleRunstop},null,8,["modelValue","color","icon"])])),_:1})])),_:1})])),_:1})}var c=o(88603),l=o.n(c),u=o(61959),d=o(49905),p=o(29378);const m={ref:"joyCon"};function g(e,t,o,r,s,a){return(0,n.wg)(),(0,n.iD)("div",m,null,512)}var v=o(32156),f=o(27575),_=o.n(f);const w={emits:["event"],setup(e,{expose:t,emit:o}){t();const r=(0,u.iH)(null);var s;function a(){s.on("start end dir:up dir:left dir:down dir:right",((e,t)=>{o("event",e.type)}))}(0,n.bv)((()=>{let e={zone:r.value,mode:"static",size:200,position:{left:"50%",bottom:"50%"},color:v.ZP.getPaletteColor("white"),threshold:.25,fadeTime:400,maxNumberOfNipples:1,dynamicPage:!0};s=_().create(e),a()}));const i={emit:o,joyCon:r,joystick:s,bindNipple:a,ref:u.iH,onMounted:n.bv,colors:v.ZP,nipplejs:_()};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}};var b=o(74260),h=o(7050),y=o(7518),S=o.n(y);const T=(0,b.Z)(w,[["render",g],["__scopeId","data-v-76410647"]]),C=T;S()(w,"components",{QResponsive:h.Z});var j=o(59807),R=o(72012);const I={setup(e,{expose:t}){t();const o=(0,u.iH)(null),r={base:(0,d.Z)("primary"),arm:(0,d.Z)("secondary")},s=(0,u.iH)(300),a=(0,u.qj)({controlMode:"base",runstop:!1,touching:!1,gripperClosed:!1,direction:null,cmdVelTopic:p.Qu.cmdVelTopic.name,velocity:{linear:.08,angular:15}}),i=(0,u.qj)({backgroundColor:r[a.controlMode]}),c=(0,u.qj)({height:s.value+"px"});function m(){(0,p.cf)(a.velocity.angular)}function g(){(0,p.cf)(-a.velocity.angular)}function v(){a.runstop=!a.runstop,(0,p.Do)(a.runstop)}function f(){a.gripperClosed=!a.gripperClosed,(0,p.TW)(a.gripperClosed)}function _(){(0,p.W7)("/camera/realsense2_camera/reset"),(0,p.W7)("/wrist_camera/realsense2_camera/reset")}function w(e){"start"===e?(a.touching=!0,(0,p.TP)("/switch_to_position_mode"),console.log("Touch start.")):"end"===e?(a.touching=!1,(0,p.TP)("/stop_the_robot"),console.log("Touch end.")):l().startsWith(e,"dir:")&&(a.direction=l().split(e,":")[1])}(0,n.YP)((()=>{a.gripperClosed}),((e,t)=>{ripperControl(e)})),(0,n.bv)((()=>{setInterval((()=>{if(a.touching)if(console.log(a.controlMode),"base"===a.controlMode)switch(a.direction){case"up":(0,p.uH)(a.velocity.linear);break;case"down":(0,p.uH)(-a.velocity.linear);break;case"left":(0,p.sc)(a.velocity.angular);break;case"right":(0,p.sc)(-a.velocity.angular);break}else if(a.controlMode="arm")switch(a.direction){case"up":(0,p.Fw)(a.velocity.linear/5);break;case"down":(0,p.Fw)(-a.velocity.linear/5);break;case"left":(0,p.hb)(-a.velocity.linear/5);break;case"right":(0,p.hb)(a.velocity.linear/5);break}}),100)}));const b={joyContainer:o,controlStyles:r,cardHeight:s,state:a,modeStyle:i,cardStyle:c,wristInc:m,wristDec:g,toggleRunstop:v,toggleGripper:f,resetCameras:_,handleJoystick:w,_:l(),toRefs:u.BK,ref:u.iH,reactive:u.qj,watch:n.YP,watchEffect:n.m0,computed:u.Fl,onMounted:n.bv,getCssVar:d.Z,rosInterface:p.Qu,triggerServiceByName:p.TP,triggerEmptyServiceByName:p.W7,baseTranslate:p.uH,baseTurn:p.sc,gripperControl:p.TW,armMove:p.hb,liftMove:p.Fw,wristMove:p.cf,setRunstop:p.Do,Joy:C,NumericInput:j.Z,Camera:R.Z};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}};var W=o(24379),B=o(10151),Z=o(25589),q=o(52496),k=o(58408),O=o(65869),M=o(99367),V=o(48240),L=o(21007),P=o(39200),Q=o(39975),x=o(90269);const N=(0,b.Z)(I,[["render",i],["__scopeId","data-v-1e8386c0"]]),F=N;S()(I,"components",{QPage:W.Z,QCard:B.Z,QCardSection:Z.Z,QTabs:q.Z,QTab:k.Z,QSeparator:O.Z,QCardActions:M.Z,QBtn:V.Z,QPageSticky:L.Z,QFab:P.Z,QFabAction:Q.Z}),S()(I,"directives",{TouchRepeat:x.Z})}}]);